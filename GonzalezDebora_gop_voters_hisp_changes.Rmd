---
title: 'Local Demographic Changes and US Presidential Voting, 2012-2016: A Replication'
author: "Debi Gonzalez"
date: "4/25/2020"
output: bookdown::pdf_document2
bibliography: bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)


library(haven)
library(tinytex)
library(stargazer)
library(ggplot2)
library(ggthemes)
library(tidyverse)
library(gt)
library(broom)
library(cowplot)
library(plm)

```


```{r data setup}

# Here I load two of the original datsets, which I will use to replicate the main
# results of Hopkins, Hilla, and Huber.

geo_scope <- read_dta("dataverse_files/HHHDemogThreatRepArchive/GeographicScopeData.dta")
  
precinct_data <- read_dta("dataverse_files/HHHDemogThreatRepArchive/PrecinctData.dta")

```

\newpage
# Abstract

Hilla, Hopkins, and Huberc (2019) argue that demographic changes are not associated with increased Republican vote share at the precinct level between 2012 and 2016. I succesfully replicated Hilla, Hopkins and Huberc’s results, except for minor discrepancies which do not affect their conclusions. A robustness test using a subset analysis focusing on the state of FL indicates, despite minor state-specific deviance and poor statistical significance due to reduced sample size, that the authors' overall findings are valid. Another test focusing on the effect of individual states on the overall findings was also found to support the original paper's robustness. In addition, I constructed a fixed effects model by state, which further confirmed original findings even under fixed effects assumptions. In a twist of analysis, I constructed a new model analyzing the association between Republican vote share and economic indicators while controlling for Hispanic proportion. The latter models appear to indicate a stronger relationship between unemployment proportion change and GOP vote share than between changes in Hispanic proportion and GOP vote share, which suggests an opportunity for further research. 



# Introduction

Immigration and demographic changes have become salient in American political discourse in great part due to Trump's capaign for tthe 2016 election. Inspired by previous inconclusive research on threatened response and county-level electoral outcomes, Hilla, Hopkins, and Huberc, henceforth HHH, compiled a novel, precinct-level data set of election results and census demographic measures for almost 32,000 precincts across 7 states to explore how demographic changes influenced republican vote share in affected precincts across the United States [@. The authors employed regression models with varying explanatory variables and measures of demographic change. Through this analysis, the authors find consistent evidence that 'influxes of Hispanics or non-citizen immigrants' were associated with decreased Republican vote share, which was assumed by the authors to mean shifts towards Trump's opponent in 2016 [@research]. Dan Hopkins offers an overview and a link to the data for this research paper on [his website](http://web.sas.upenn.edu/danhop/research/">his website). The full original paper can be found [here](https://www-pnas-org.ezp-prod1.hul.harvard.edu/content/pnas/116/50/25023.full.pdf).


Using R and RStudio, I succesfully replicated HHH’s results, except for minor discrepancies which do not affect their conclusions [@R]. Some of these discepancies can be associated with the inherent assumptions of the Stata software versus R. The replication process was lengthy and focused mainly on translating local variables from Stata (the coding language in which the original analysis was conducted) into R using the original datasets to construct the main eight models supporting the argument. A step by step replication of the 8 main models and graphics of the paper are included in the appendix. Thanks to the generosity of the authors the code and data used in this project are available at [Harvard Dataverse](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/J5GCZQ). For more information about this project please visit my project's Github repo^[[The data and code for this project can be found here.](https://github.com/deboragonzalez/gop_voters_hisp_changes)].



```{r graphic, warning = FALSE}

# This graphic is an initial attempt to replicate Fig. 1A from the paper:

# Change in Republican vote share, 2012 to 2016, and change in Hispanic
# population 2011-2016. Note: Points are random samples of 2,000 precincts.
# Loess lines are generated from all observations. Points are shaded
# corresponding to density, with darker colors indicating more precincts.

# My graphic complies with the first two lines of that description. I am using
# the sample function to get a random sample from my geo_scope dataset. I used
# the geoscope dataset because I wanted to color the dots by state, which the
# authors do not do, but I thought would be interesting and prettier. I was able
# to create the loess line using geom_smooth, which does not appear disimilar to
# the paper's model. I also added the aesthetic enhancement of size as number of
# voters in 2016 in each precinct.

geo_scope2 <- geo_scope %>% 
  drop_na()

try2 <- sample_n(geo_scope2, 2000)
  
# With every sample ran a different number of non-finite/missing values exists,
# and a warning sign appears. Because these values are not relevant to the
# graphic I'm constructing, I will ignore this warnings.



try2 %>% 
  ggplot(aes(x = gop_propvote_change, y = d1611_hispanic, size = Total_Voters_2016_Prct)) + 
  
  # gop_propvote_change is Change in Prop of Republican Voters 2016-2012
  # d1611_hispanic is Change in Prop of Hispanic 2011-2016
  # Total_Voters_2016_Prct is total number of voters by precinct
  
  geom_point(aes(color = st), alpha = 0.5) +
  
  # st refers to state label
  
  stat_smooth(method = "loess", formula = y ~ x, size = 1, se = FALSE) +
  
  # Method loess is a smoothing method that acts much like a regression, but it
  # is not linear.
  
  xlim(-.3,.3) +
  
  # This will emphasize the part of the graph that is most dense.
  
  labs(title = "Republican Vote Share Change vs. Hispanic Population Share Change",
       subtitle = "How changes in hispanic population share from 2011 to 2016 relate \nto changes in GOP Votes share from the 2012 to the 2016 election", caption = "Source: HHH Demographic Threat Data Archive: Geo_Scope",
       x = expression(Delta*" Republican Vote Share 2012-2016"),
       y = expression(Delta*" Hispanic Population Share 2011-2016"),
       size = "Number of Voters \nby Precinct in 2016",
       color = "State") + 
  theme_classic()
 
  
```
A visual association between changes of Republican Vote Share and Hispanic Population Proportion Change from 2012-2016. Random sample of 2000 precincts colored by state [@ggplot]. A loess line highlights the general trend of the data [@smooth]. I also added the aesthetic enhancement of size as number of voters in 2016 in each precinct [@data].
 
 
I determined two main ways to examine the robustness of these models: 1) I examined the model outputs at higher level of aggregation by constructing the same models using a subset of data by state. In this case, I used Florida, which is my home state and one that has received a very high influx of hispanics over the last decade. Despite, the smaller sample, which inherently causes decreased statistical significance, HHH's overall conclusions are validated. In addition, I constructed a series of models excluding a different state each time to examine whether any single state was shaping the conclusions and found that no individual state is driving the original conclusions. 2) Heterogeneity in fixed effects models means different means among categories such as states and year. Unobserved heterogeneity is simply variation/differences among cases which are not measured. When the data can be grouped by such categories, and there are also some evidences indicating heterogeneity, the OLS is not sufficient to control the effects of these unobservable factors [@fixed]. However, fixed effects models can control and estimate these effects. I constructed mirror models using plm(y ~ x, data = mydata, within = “state”) and found that a fixed effects model do not alter the overarching conclusions even when absorbing the effects particular to each state [@fixed2]. Both methods resulted in successful measures of robustness confirming HHH's original quantitative findings, if not the exact theoretical claim. 

In addition to exploring the robustness of HHH's findings, I built a new model using the original datasets to explore the association between economic indicators and changes in Republican voters. I constructed a series of models that explain shifts in GOP share of voters in terms of changes in hispanic proportion, changes in unemployment, and proportion change of poor to consider the economic influences on Republican voters share shifts respectively and in combination. In addition, I construct a model to examine how the interaction of change in unemployment and change in Hispanic proportion affect GOP vote share in each time period. I also construct a model using only changes in unemployment and proportion change of poor as explanatory variables to GOP share in these intervals. The results show that unemployment may have an even stronger effect on GOP share of voters between 2011-2016, but not in the 2000-2016, indicating an interesting trend in.... (penalization of candidates, demographic preferences, etc?).
 
 
 
DELETE
The first paragraph is a review of the paper you are replicating. Place it within the relevant literature, via a key citation or two. Highlight implications and caveats. 

The second paragraph provides more details on your replications. Mention that you used R, and provide an citation to R which will appear in your bibliography. (See citation().) Cite the location from which you got the data and code for your replication. (This might be to the Dataverse, a webpage or “personal communication” with the author.) Provide a footnote with a link to your repo.

The Third and Fourth paragraphs: What did you do? What did you find?
DELETE


\newpage
# Paper & Literature Review


Using a data set of nearly 32000 precincts across the states of Florida, Georgia, Michigan, Nevada, Ohio, Pennsylvania, and Washington, HHH aimed to understand whether demographic changes at low levels of aggregation were associated with vote shifts toward an anti-immigration presidential candidate between 2012 and 2016.

if something is worth understanding about the literature
any relevant literature that has come out since then
provide a summary in whatever level of detail you think is appropriate. 

Notably, the authors discuss the research on the different ways in which influx of immigrants affect voters' response, but the variables used in this analysis mainly focus on influx of Hispanics


# Replication

I was able to successfully translate and replicate the main analysis of the original paper despite minor deviances that did not affect the overall conclusions of the study. Since the original analysis was done in Stata, this project required the translation of the code and a comparative analysis. A full replication of Table 1 and Figure 1 using the most approximate R tools of the original paper can be found in the appendix. 

\newpage
# Robustness Check #1: Subsetting the Data

One way to test for robustness is to examine the ways in which different states affect the overall trends. Notably, if a subset of the data has largely skewed results, the original findings are not invalidated given the diminished statistical significance of the subset, but the results' predictive applicability and generizability can be questioned. For this project, I decided to run the main 8 original models on a smaller subset of the data - the precincts in the state of Florida. Examining the single state allowed me to zoom in and see how these associations look like in a state that is increasingly known as a swing state in U.S. elections. 

```{r fl_subset, results="asis"}

fl_data <- precinct_data %>% 
  filter(st == "FL")

flm1 <- lm(gop_propvote_change ~ d1611_hispanic, data = fl_data, weights = weight) 



# Regression Model 2:


flm2 <- lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid, 
         data = fl_data, 
         weights = weight) 




#Regression Model 3:


flm3 <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = fl_data, 
         weights = weight) 



# Regression Model 4:

flm4 <-  lm(gop_propvote_change ~  dprop1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = fl_data, 
         weights = weight) 


# Regression Model 5:



flm5 <- lm(gop_propvote_change ~ d1600_hispanic, 
         data = fl_data, 
         weights = weight) 



# Regression Model 6:



flm6 <- lm(gop_propvote_change ~ d1600_hispanic + l00_hispanic + d1600_poor + d1600_unemp + 
           d1600_mfg + d1600_pop + l00_poor + l00_unemp + l00_mfg + l00_density + l00_black + 
           l00_educba + countyid,
         data = fl_data,
         weights = weight)


# Regression Model 7:
# regress `dv' `iv_c_1600' `cv_c_1600' `cv_l_1600' rv12d_* [aweight=weight], robust

flm7 <- lm(gop_propvote_change ~ d1600_hispanic + l00_hispanic + d1600_poor + d1600_unemp + 
           d1600_mfg + d1600_pop + l00_poor + l00_unemp + l00_mfg + l00_density + l00_black + 
           l00_educba + countyid + decile_repvote12,
         data = fl_data,
         weights = weight)



# Regression Model 8:
# regress `dv' `iv_pc_1600' `cv_c_1600' `cv_l_1600'  rv12d_* [aweight=weight], robust

flm8 <- lm(gop_propvote_change ~ dprop1600_hispanic + l00_hispanic + d1600_poor + d1600_unemp + 
           d1600_mfg + d1600_pop + l00_poor + l00_unemp + l00_mfg + l00_density + l00_black + 
           l00_educba + countyid + decile_repvote12,
         data = fl_data,
         weights = weight)


stargazer(flm1, flm2, flm3, flm4, flm5, flm6, flm7, flm8,
          title = "Change in Republican vote share 2012 to 2016 and change in Hispanic population, various time intervals in FL",
         omit = c("d1611_poor", "d1611_unemp", "d1611_rent", "d1611_rent_income", "d1611_housing_150", "d1611_mfg",
                  "d1611_pop", "l11_poor", "l11_unemp", "l11_rent", "l11_rent_income", "l11_housing_150", "l11_mfg",
                  "l11_density", "l11_black", "l11_educba", "countyid", "d1600_poor", "d1600_unemp", "d1600_mfg",
                  "d1600_pop", "l00_poor", "l00_unemp", "l00_mfg", "l00_density", "l00_black", "l00_educba",
                  "decile_repvote12"),
                  covariate.labels = c("Change in Prop. Hispanic, 2011 to 2016", "Prop. Change in Prop. Hispanic, 2011 to 2016",
                              "Prop. Hispanic 2011", "Prop. Change in Prop. Hispanic, 2000 to 2016",
                              "Change in Prop. Hispanic, 2000 to 2016","Prop. Hispanic 2000"),
         omit.stat = c("f", "ser"),
         dep.var.labels.include = FALSE,
         
         # Need to work on getting rid of dependent variable row.
         
         column.sep.width = "-20pt",
         no.space = T)
```


Despite the lack of statistical significance across many of the coefficients in Table 1, comparing these models' output and their significance to those of the original data models solidify HHH's central finding as even a small subset of the data seems to confirm their overarching conclusion that demographic shifts do not lead to increased GOP share of votes, but rather the opposite. I think the question can now become whether or not the influx of hispanics can be interpreted as an influx of immigrants (which is a big discussion in the theoretical part of the original paper) or if it simply refers to U.S. born Hispanics, which have been found in previous research to vote in favor of Democratic candidates. In the main eight regressions explored in the study, foreign born population is not included as an explanatory variable control, so this change in Hispanic proportion can be assumed to include any Hispanic in America. Notably, the appendix of the original paper contains a table that explores the effect of foreign born changes on GOP vote share. Perhaps the relationships uncovered through those models can help clarify the more specific claim discussed in the literature. Unfortunately, I was unable to gain access to the appendix for this project. Overall, these models serve as a robustness check to HHH's findings and provide some insight into the consequences of slicing the data in different ways and the potential effect individual states may be having on the data as a whole, which is further explored in the next set of models.



Another similar, but more extensive way to test for robustness, is to build a series of models in which a different state is substracted from the sample each time. This allows to observe whether the overall trend is largely skewed by any individual state.


```{r state effect, results="asis"}

# Evaluating individual state effects mirroring original Model 3 (2011-2016):

# The states: Florida, Georgia, Michigan, Nevada, Ohio, Pennsylvania, and Washington

# The datasets minus 1 state:

no_fl <- precinct_data %>% 
  filter(st != "FL")

no_GA <- precinct_data %>% 
  filter(st != "GA")
  
no_MI <- precinct_data %>% 
  filter(st != "MI")
  
no_NV <- precinct_data %>% 
  filter(st != "NV")
  
no_OH <- precinct_data %>% 
  filter(st != "OH")

no_PA <- precinct_data %>% 
  filter(st != "PA")

no_WA <- precinct_data %>% 
  filter(st != "WA")

# Model 3 minus one state:

no_flm <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_fl, 
         weights = weight)

no_gam <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_GA, 
         weights = weight) 

no_mim <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_MI, 
         weights = weight) 

no_nvm <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_NV, 
         weights = weight) 

no_ohm <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_OH, 
         weights = weight) 

no_pam <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_PA, 
         weights = weight) 

no_wam <-  lm(gop_propvote_change ~ d1611_hispanic + l11_hispanic + d1611_poor + d1611_unemp + 
           d1611_rent + d1611_rent_income + d1611_housing_150 + d1611_mfg + d1611_pop + 
           l11_poor + l11_unemp + l11_rent + l11_rent_income + l11_housing_150 + l11_mfg + 
           l11_density + l11_black + l11_educba + countyid + decile_repvote12, 
         data = no_WA, 
         weights = weight) 



stargazer(no_flm, no_gam, no_mim, no_nvm, no_ohm, no_pam, no_wam,
          title = "Change in Republican vote share 2012 to 2016 and change in Hispanic population",
         omit = c("d1611_poor", "d1611_unemp", "d1611_rent", "d1611_rent_income", "d1611_housing_150", "d1611_mfg",
                  "d1611_pop", "l11_poor", "l11_unemp", "l11_rent", "l11_rent_income", "l11_housing_150", "l11_mfg",
                  "l11_density", "l11_black", "l11_educba", "countyid", "d1600_poor", "d1600_unemp", "d1600_mfg",
                  "d1600_pop", "l00_poor", "l00_unemp", "l00_mfg", "l00_density", "l00_black", "l00_educba",
                  "decile_repvote12"),
                  covariate.labels = c("Change in Prop. Hispanic, 2011 to 2016",
                              "Prop. Hispanic 2011"),
         omit.stat = c("f", "ser"),
         dep.var.labels.include = FALSE,
         
         # Need to work on getting rid of dependent variable row.
         
         column.sep.width = "-8pt",
         no.space = T)


```

The coefficients of these models (each of which excludes a different state) consistently support HHH's findings and conclude that the results are not driven by any single state. 

# Robutness Check #2: Fixed Effects Model


# A New Model: Economic Indicators & Hispanic Population Change


# Conclusion

The first paragraph is a review of the paper you are replicating. Place it within the relevant literature, via a key citation or two. Highlight implications and caveats. 

The second paragraph provides more details on your replications.

Conclusion, the last paragraph is where you get to speculate: What does it all mean? What should we research next?

# Appendix

# References

